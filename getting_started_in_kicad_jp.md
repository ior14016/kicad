# はじめに

この文章は[KiCAD 公式ドキュメント Ver8.0](https://docs.kicad.org/8.0/en/getting_started_in_kicad/getting_started_in_kicad.html)を翻訳し，実習用に編集したものです．<br>
一部簡略されている部分があるため，深く知識を得たい場合は，[公式ドキュメント](https://docs.KiCAD.org/)に目を通すことをおすすめします．<br>

公式ドキュメントは日本語も存在しますが，<font color="red">**翻訳が不完全**</font>です．<br>
本文書は KiCAD(Ver8.0)で使用されている UI を元に`日本語`で説明を行いますが，今後文章が変化することが予想されます．<br>
Google 翻訳や DeepL 翻訳などを使用して読み進めることをおすすめしますが，画像内の言語は翻訳できないため，普段から<font color="red">**英語**</font>で使用することを強く推奨します．<br>

本文書は，<font color="green">Windows11</font>での操作方法を説明します．<br>
それ以外の OS などについては異なる外見や動作を行うことが予想されますが，読み替えるなどして自己対応をお願いいたします．<br>

また，本文書は**教育目的のみ**に使用することを前提としています．<br>
著作権や営利目的などの権利等については，[KiCAD 公式ドキュメント](https://www.KiCAD.org/about/licenses/)に記載されていることに従ってください．<br>

基本的に，文字を入力する際は<font color="red">**半角英数字のみ**</font>を使用します．<br>
全角文字や絵文字などを使用すると文字化けなどが発生し，最悪の場合は製作したデータが破損・読み込めないことが予想されます．<br>
必ず，`半角英数字`を使用してください．<br>
**それ以外は動作を保証できません!**<br>

KiCAD は開発段階のソフトウェアですので，突発的な動作停止(フリーズ)もありえます．<br>
フリーズを抑える方法はおまけに記載しますが，せっかくの作業データを失わないよう，こまめにデータを保存することをおすすめします．<br>

> `Ctrl`+`S`で保存．<br>

# 目次

- [はじめに](#はじめに)
- [目次](#目次)
- [KiCAD とは?](#kicad-とは)
- [Part1:プロジェクト](#part1プロジェクト)
- [Part2:回路図](#part2回路図)
  - [シンボルライブラリの設定](#シンボルライブラリの設定)
  - [回路図エディターの基本](#回路図エディターの基本)
  - [回路図シートのセットアップ](#回路図シートのセットアップ)
  - [回路図へのシンボルの追加](#回路図へのシンボルの追加)
  - [オブジェクトの選択と移動](#オブジェクトの選択と移動)
  - [回路図の配線](#回路図の配線)
  - [注釈の配置](#注釈の配置)
  - [シンボルのプロパティ](#シンボルのプロパティ)
  - [フットプリントの割り当て](#フットプリントの割り当て)
  - [電気的ルールのチェック(ERC)](#電気的ルールのチェックerc)
  - [部品表](#部品表)
- [Part3:回路基板](#part3回路基板)
  - [PCB エディターの基本](#pcb-エディターの基本)
  - [ボードのセットアップとスタックアップ(デザインルール)](#ボードのセットアップとスタックアップデザインルール)
  - [回路図からの変更のインポート](#回路図からの変更のインポート)
  - [PCB 基板の 3D 表示](#pcb-基板の-3d-表示)
  - [フットプリントの配置修正](#フットプリントの配置修正)
  - [配線](#配線)
  - [基板のアウトライン(外形線)，レイヤーの選択](#基板のアウトライン外形線レイヤーの選択)
  - [基板の塗りつぶし](#基板の塗りつぶし)
  - [デザインルールチェック(DRC)](#デザインルールチェックdrc)
- [Part4:外注](#part4外注)
- [まとめ](#まとめ)
- [おまけ(フリーズ対策)](#おまけフリーズ対策)

# KiCAD とは?

電化製品などの中に必ず存在するのが`PCB基板`です．<br>
PCB 基板は小型・軽量・大量生産に向いており，スマートフォンなどの電子機器が一般的となった現代社会には欠かせないものとなっています．<br>
そんな PCB 基板を設計できるソフトウェアが`KiCAD`です．<br>
KiCAD を使用することで，部品や配線などをソフトウェア内で配置することができ，実際に基板を製作する前に不具合がないかを確認することできます．<br>

そして，KiCAD で製作した回路は国内外の基板製作会社に外注することで，あなたが望む基板を安価に入手することができます．<br>
ぜひ KiCAD をマスターして，電子工作へのさらなるスキルアップを目指してください！<br>

# Part1:プロジェクト

KiCAD へようこそ！あなたにとって偉大なる一歩です．<br>
基本的な流れとしては，<font color="green"></font>`回路図エディター`で回路図を書き，`PCBエディター`で部品の配置や基板の形や大きさを設定します．<br>

インストールを終えたら，最初の初期設定をしましょう．<br>
KiCAD を開くと，`プロジェクトマネージャー`が表示されます．<br>

> KiCAD を全く起動したことがない人は初期設定を尋ねられます．<br>

`環境設定(Preference)` -> `言語設定(Set Language)`から，`日本語`を選びましょう．<br>

> 個人的には(公式ドキュメントが英語なので)`英語`で行うことを推奨しますが，本文章では`日本語`で進めていきます．<br>

設計図はプロジェクトごとに分けて管理しておきたいため，

1. `ファイル` -> `新規プロジェクト` をクリック
2. `document`フォルダに新しく`KiCAD-project`フォルダを作成
3. `KiCAD-project`フォルダ内に`getting-started`と名付けたプロジェクトを作成
4. `このプロジェクト用に新しいフォルダを作成` チェックボックスがチェックされていることを確認し，`保存`をクリックします．

以上を行って，管理しやすくしましょう．<br>

> この時，プロジェクト名は必ず`半角英数字`で命名しなければなりません．<br>
> 日本語などの全角文字・数字・絵文字を使用した際の動作は保証できません．<br>

これで，プロジェクトと同じ名前の新しいサブフォルダーにプロジェクトファイルが作成されます．<br>

![fig.001](/pictures/001.png)
![fig.002](/pictures/002.png)

# Part2:回路図

いよいよ回路図を書いていきます．<br>

まずは例として簡単な回路図を書いていきましょう．<br>
この回路は以下の回路部品で構成されており，LED を光らせるだけの簡単な回路です．<br>

| 回路部品名 | 個数 | 詳細      |
| ---------- | ---- | --------- |
| 単三乾電池 | 2    | 1.5V      |
| 抵抗       | 1    | 1kΩ (ohm) |
| LED        | 1    | 青色      |

以上の回路部品で構成される回路図を，一緒に作成していきましょう．<br>

## シンボルライブラリの設定

皆さんがよく目にする回路部品図は，KiCAD では**シンボル**と呼ばれています．<br>
それらシンボルをまとめた一覧表，または辞書のようなもの，それが**シンボルライブラリ**です．<br>
基本的にはシンボルライブラリから回路図に必要なシンボルを選び，回路図上に配置していくのが大まかな流れです．<br>

`回路図エディター`を開きましょう．<br>

> 最初に**回路図エディター**を開くと，グローバルシンボルライブラリテーブルの設定方法を尋ねるウィンドウが表示されます．<br>
>
> `既定のグローバルシンボルライブラリテーブルをコピーする(推奨)`を選びましょう．

> デフォルトのライブラリテーブルファイルの場所は `C:\Program Files\KiCAD\8.0\share\KiCAD\template\`となります．<br>

## 回路図エディターの基本

右クリック or マウスホイールを押しながらマウスを動かすと，回路図を`パン`(撮影技法で用いられる専門用語，左右に降ることを意味する．上下に降るときは`チルト`と呼ぶ)することができます．<br>
マウスホイールを動かすと拡大(ズームイン)・縮小(ズームアウト)ができます．<br>

## 回路図シートのセットアップ

回路図で何かを描画する前に，回路図シート自体を設定します．<br>
これを行うことで，完成した回路図を印刷 or 電子データとして残す際に書式が整い，見た目がきれいになります．<br>

`ファイル` -> `ページ設定` 回路図にタイトルと日付を与え 必要に応じて用紙サイズを変更します．<br>
今回は以下のようにします．<br>

| 記入欄     | 実行内容               | 説明                             |
| ---------- | ---------------------- | -------------------------------- |
| 発行日     | `<<<`を選択            | 本日の日付が入ります             |
| リビジョン | `1.0.0`を記入          | バージョン管理の際に使用します   |
| タイトル   | `LED-test`を記入       | プロジェクト名を記載してください |
| 会社名     | あなたの名前などを記入 | 私は`ior14016jp`とします         |

枠の右下に反映されていれば OK です．<br>

![fig.003](/pictures/003.png)

## 回路図へのシンボルの追加

回路図にシンボルを追加して回路を作り始めます．<br>

ウィンドウの右側にあるツールバーから `シンボルを追加` ボタンをクリックすると`シンボルを選択`ウィンドウが開きます．<br>

![fig.004](/pictures/004.png)

> ショートカットキーは`A`<br>

> 初期設定ウィンドウが出た際は，`既定のグローバルフットプリントライブラリテーブルをコピー(推奨)`を選んでください．<br>

`シンボルを選択`ウィンドウには様々な回路記号が並んでいます．<br>
ここからあなたが使用したい回路部品を選んで配置していきます．<br>
`フィルター`に`LED`と打ち込んでみましょう．<br>
様々な種類の LED が表示されますが，最も汎用的な`LED`を選び，`OK`を押します．<br>

![fig.005](/pictures/005.png)

選んだ`LED`シンボルがマウスに追従しますので，シートの真ん中あたりに左クリックで配置します．<br>

> もし配置するものを間違えた場合や，今何を行っているかわからなくなった場合は，慌てず`ESC`キーを複数回押しましょう．<br>
> シート上の部品の上で`右クリック` -> `削除` を選択すると，部品を削除できます．<br>
> 削除のショートカットキーは左クリックして`Delete`<br>

同様にして，単四電池(Battery_cell)を 2 つと抵抗(R)を 1 つ配置してみましょう．<br>

![fig.006](/pictures/006.png)
![fig.007](/pictures/007.png)
![fig.008](/pictures/008.png)

## オブジェクトの選択と移動

必要なシンボルがシート上に配置できましたが，向きが望ましくありません．<br>
シンボルを適切な位置に移動，回転しましょう．<br>

移動したいシンボルを左クリックして選択した後，ドラッグすることで移動できます．<br>

> 動かせない場合は右側のツールバーで`アイテムを選択`状態になっているか確認してください．<br>`ESC`キーを数回押すことでも`アイテムを選択`状態にすることができます．<br>

回転させたいシンボルを左クリックしましょう．<br>
プロパティ内に`向き`，`X軸でミラー`，`Y軸でミラー`の 3 項目がありますので，提示された図のように配置してみましょう．<br>

![fig.009](/pictures/009.png)

> ショートカットキーは`R`(回転)，`X`(X 軸側にミラー)，`Y`(Y 軸側にミラー)

## 回路図の配線

ただシンボルを配置しただけでは意味がありません．<br>
各シンボル間をつなげるための配線を行います．<br>

シンボルからはピンが伸びており，その先端には必ず小さな丸がついています．<br>
この小さな丸はシンボルピンが配線されていないことを意味し，シンボルピン間をワイヤーで配線することでこれを修正することができます．<br>

ワイヤーを配線するためには右側のツールバーから`ワイヤーを追加`を選びましょう．<br>

![fig.010](/pictures/010.png)

> ショートカットキーは`W`<br>

> 右側のツールボックスには`ワイヤーを選択`の下に，`パスを追加`という<font color="red">**非常によく似たアイコン**</font>があります．<br>本文章内では使用しないため，間違えないよう注意してください．<br>

マウスカーソルが変化したことがわかります．<br>
お気づきかもしれませんが，マウスカーソルは選択されているモードによって若干変化しています．<br>
なにかが間違っていると感じた場合は，マウスカーソルの形や右側のツールバーを見て，選択されているモードが間違っていないかを確認してみてください．<br>

ワイヤーを選択した後，左クリックを行うと，ワイヤーが伸び始めます．<br>
ワイヤーはシンボルピンをクリックするか，任意の場所をダブルクリックするまでワイヤーは描画され続けます．<br>

ワイヤーを描画するもう一つの方法は接続されていないピンにカーソルを合わせることです．<br>
マウスカーソルが変化し，その位置からワイヤーを描画することができます．<br>

ワイヤーの使い方をマスターしたら，図のように配線してみましょう．<br>

![fig.011](/pictures/011.png)

次に，回路図にパワーとグランドのシンボルを追加します．<br>
電源シンボルとグランドシンボルは，Power シンボルライブラリに多数用意されています．<br>
右側ツールバーから`電源シンボルを追加`を選択しましょう．<br>

![fig.012](/pictures/012.png)

> ショートカットキーは`P`<br>

> 先にシンボルを追加したように，ツールバーから`シンボルを追加` ボタンをクリックして，`シンボルを選択`ウィンドウからも追加できます．<br>
> 様々な電圧に対応する電源シンボルが表示されますが，`VCC`と`GND`を図のように配置して，配線してください．<br>

![fig.013](/pictures/013.png)
![fig.014](/pictures/014.png)
![fig.015](/pictures/015.png)

配線の完成です．<br>

## 注釈の配置

シンボルの側には，コメントらしきものが配置されています．<br>
本回路にはわずか 4 つしか部品がありませんが，大規模な回路には数百単位での部品が存在することが予想されます．<br>
それら全てが同じ電圧，同じ抵抗値，同じ型番であることはほぼありえません．<br>
1 つ 1 つの部品を区別できる，注釈を添える必要があります．<br>

> この作業は`アノテーション`と呼ばれています．<br>

上側のツールバーから`回路図シンボルのリファレンス指定子を記入`を選択すると，`回路図をアノテーション`ウィンドウが開きます．<br>

![fig.016](/pictures/016.png)

`アノテーションをクリア`を選択すると，シンボルの側にあるコメントらしきものが変化します．<br>

![fig.017](/pictures/017.png)

この状態で，`アノテーション`を選択すると，数字が割り振られます．<br>

![fig.018](/pictures/018.png)

これで部品ごとに名前をつけることができました．<br>

## シンボルのプロパティ

そういえば，乾電池の電圧や抵抗値，LED の色などをどこにも記載していません．<br>
電池を右クリックして`プロパティ`を選びましょう．<br>

> ショートカットキーは`E`<br>

`シンボルのプロパティ`ウィンドウが表示されます．<br>
値には`Battery_cell`と記載されていますが，`1.5V`と書き換えましょう．<br>

![fig.019](/pictures/019.png)

同様にしてすべての部品に以下のようにプロパティを編集してください．<br>

| 項目欄 | 変更前       | 変更後 |
| ------ | ------------ | ------ |
| BT1    | Battery_cell | 1.5V   |
| BT2    | Battery_cell | 1.5V   |
| R1     | R            | 1k     |
| D1     | LED          | Blue   |

> 半角英数字以外は使用しないでください！ 動作を保証できません！<br>

## フットプリントの割り当て

`フットプリント`というものが存在します．<br>
これは基板に抵抗や LED などをはんだ付けするための接着部分を正確に図で示したものです．<br>

> 接着部分を`ランド`または`パッド`と呼びます．<br>

しかし，回路部品には様々な形，大きさ，型番が存在します．<br>
電池を例にとっても，単三電池と単四電池では電圧は同じですが，大きさが全く違います．<br>
そのため，シンボルにどのような部品を使用するかを正確に割り当てる必要があります．<br>
部品の大きさは規格化されているため，規格に沿った部品は KiCAD が用意しているフットプリントライブラリから選択するだけで問題ありません．<br>

上側のツールバーから`フットプリント割り当てツールを実行`を選ぶと，`フットプリントを割り当て`ウィンドウが開きます．<br>

![fig.020](/pictures/020.png)

左右にあるフットプリントライブラリから適合するものを選び，シート上に配置されているシンボルに割り当てていきます．<br>

左側にあるフットプリントライブラリから，`Battery`を選びます．<br>

![fig.021](/pictures/021.png)

膨大な量から適合するものを選ぶのは骨が折れるため，`フットプリントフィルター`右側にある 3 つのフィルター機能を使って絞り込みます．<br>
主に使用するのは中央と右側のフィルター機能です．<br>
検索部分に`AAA`と入力してみましょう．<br>

![fig.022](/pictures/022.png)

> `AAA`は`単四電池`を意味します．<br>
> JIS 規格では`R03`と表記されます．<br> `フィルターしたフットプリント`の一覧に表示されているものを右クリックすると，フットプリントを見ることができます．<br>

今回は`BatteryHolder_KeyStone_2466_1xAAA`を使用します．<br>

`BT1`を選択した後，`BatteryHolder_KeyStone_2466_1xAAA`をダブルクリックすると，フットプリントが割り当てられます．<br>
同様にしてその他の部品にもフットプリントを割り当てます．<br>

> ここで使用するフットプリントは KiCAD をマスターしてもらうためのチュートリアルなので，気に入ったものを使用して構いません．<br>

例として，以下のものを使用します．<br>
項目欄|フィルター名|選択フットプリント
-|-|-
BT1|Battery|BatteryHolder_KeyStone_2466_1xAAA
BT2|Battery|BatteryHolder_KeyStone_2466_1xAAA
R1|Resistor_SMD|R_0603_1608Metric
D1|LED_SMD|LED_0603_1608Metric

問題がなければ右下の`OK`を選びましょう．<br>
これで，部品ごとにフットプリントが割り当てられました．<br>

> シンボルを配置する際に，フットプリントを割り当てることもできます．<br>
> 探してみてね．

## 電気的ルールのチェック(ERC)

回路図が完成しました．<br>
問題がないかを確認するため，チェックを行いましょう．<br>

上側のツールバーから`エレクトリカルルールのチェックを実行`を選択すると，`エレクトリカルルールチェッカー(ERC)`ウィンドウが開きます．<br>

![fig.023](/pictures/023.png)

些細なエラーも見逃さないように，`すべて`にチェックを入れ，`ERCを実行`をクリックしましょう．<br>

![fig.024](/pictures/024.png)

エラーが出ました...残念です．<br>

エラーメッセージを見ると，2 つとも`電源入力ピンが電源出力ピンによって駆動されていない`と表示されています．<br>
回路図を見ると，なにやら矢印が 2 つ指示されています．<br>
この矢印は ERC に違反している部分を指しています．<br>
一体何が駄目なのでしょうか．<br>

実はこの回路はまだ不完全なのです．<br>
そして，このエラーメッセージは KiCAD ではよくある ERC エラーです．<br>

`エレクトリカルルールチェッカー(ERC)`ウインドウを閉じて，右側ツールバーから`電源シンボルを追加`を選択しましょう．<br>
`PWR_FLAG`を VCC と GND の側に 1 つずつ配置し，それぞれを矢印にワイヤーで接続しましょう．<br>

![fig.025](/pictures/025.png)

もう一度，ERC を行います．<br>

`すべてのマーカーを削除`を選択してから，ERC を実行してみましょう．<br>
どうでしょうか？無事にエラーが消えましたか？

![fig.026](/pictures/026.png)

> **なぜ`PWR_FLAG`が必要なの？**<br>
> 人間(製作者，設計者)にとっては，VCC と GND がバッテリーや電源装置によって駆動されていることは明らかですが，回路図ではそれを明示的に示す必要があります．<br>
> 例えば，今回製作するモバイルバッテリーなどには，`回路に入力する電源`と`回路から出力される電源`が存在します．<br>
> このうち，`回路に入力する電源`によって，モバイルバッテリーに内蔵されている回路は駆動し，`回路から出力される電源`によって，外部の機器を駆動(スマートフォンを充電など)します．<br>
> しかし，KiCAD から見ればそんなことはわかりません．<br>どちらも同じ`電源`です．<br>
> したがって，`回路に入力する電源`を`回路を駆動する電源`として，明確に KiCAD に示すために`PWR_FLAG`が必要なのです．<br>

## 部品表

このパートは必須ではありませんが，覚えていると便利なので，お話します．<br>
回路シート上にある部品の一覧をエクセルなどの`表計算ソフトウェア`で表示できるファイルを出力します．<br>
この部品表を`BOM表`といい，部品を発注する際などに役に立ちます．<br>

上部ツールバーから`現在の回路図から部品表を作成`を選択し，`シンボルフィールドテーブル`ウィンドウを開きます．<br>

![fig.027](/pictures/027.png)

今のところ，既定の設定で問題ありません．<br>
`出力ファイル`右側の`フォルダアイコン`を選択して，保存しましょう．<br>
`相対パスを指定しますか`と聞かれますので，`はい`を選択し，`エクスポート`を選択すると，BOM 表が出力されます．<br>

![fig.028](/pictures/028.png)
![fig.029](/pictures/029.png)

試しに，BOM 表を`Excel`で開いてみましょう．<br>

これで回路図が完成しました．<br>

# Part3:回路基板

回路図が完成しました．<br>
しかし，まだ部品を基盤の上のどこに配置するかなどは決まっていません．<br>
実際に製品となる PCB 基板を`PCBエディター`を使って製作していきます．<br>

## PCB エディターの基本

上部ツールバーから`基板をPCBエディターを開く`を選択すると，`PCBエディター`ウィンドウが開きます．<br>

![fig.030](/pictures/030.png)

> 誤字ではありません．KiCAD の日本語訳がそう書いてるんです．(Ver8.0.0)<br>

以降の作業は`PCBエディター`をメインとして使います．<br>
操作方法は回路図エディターと同じく，マウスのホイールボタンまたは右ボタンでドラッグしてパンし，マウスホイールでズームします．<br>

## ボードのセットアップとスタックアップ(デザインルール)

このセクションは PCB 基板を製作する際，完成度合いを大きく左右する重要なセクションです．<br>
最悪の場合，お金を払って`産業廃棄物`が出来上がります．~~3 敗~~<br>
特に`スタックアップ`は非常に重要で，外部に基板を発注したりする際には，製造会社それぞれの仕様に合わせる必要があります．~~2 敗~~<br>

ボードをデザインする前に、ページサイズを設定し、タイトルブロックに情報を追加します．

1. `ファイル` -> `ページ設定`... をクリック
2. 適切な用紙サイズを選択
3. 日付、改訂、タイトルを`Part2:回路図`の`回路図シートのセットアップ`で設定したように入力

| 記入欄     | 実行内容               | 説明                             |
| ---------- | ---------------------- | -------------------------------- |
| 発行日     | `<<<`を選択            | 本日の日付が入ります             |
| リビジョン | `1.0.0`を記入          | バージョン管理の際に使用します   |
| タイトル   | `LED-test`を記入       | プロジェクト名を記載してください |
| 会社名     | あなたの名前などを記入 | 私は`ior14016jp`とします         |

次に，`ファイル` -> `基板の設定` で PCB 基板の製造方法を定義します．<br>

最も重要な設定は`スタックアップ`，つまり PCB が持つ銅と誘電体層（とその厚さ），そしてデザインルール(例えばトラックとビアのサイズ)と間隔です．<br>
`基板スタックアップ`から，`物理的スタックアップ`を選択してください，加工したい基板(生基板と言ったりします)によって適切に設定する必要があります．<br>
今回は初期設定に合わせた生基板を用意しているため，変更する必要はありません．<br>

次に，`デザインルール`の`制約`を選んでください．<br>
このページの設定は、ボードデザイン内の全てのものに優先するデザインルールを指定します．<br>

ここで設定を間違えると，最終段階で手直しが大量に発生します．~~N 敗~~<br>

> このガイドはチュートリアルなので、デフォルトで問題ありません．<br>
> しかし、実際のプロジェクトでは、外部に基板を発注したりする際には，製造会社それぞれの仕様に合わせる必要があります．<br>

最後に，`デザインルール`から`ネットクラス`を選択してください．<br>
ここでは配線間の最小幅や，絶縁部分の最小の大きさなどを設定できます．<br>

> 例えば，`電源部分`は高電流，高電圧が予想されるため，配線の抵抗値を少しでも下げるために配線の幅を太くすることがあります．

`ネットクラス`下部の`+`アイコンを選択しましょう．<br>
新しいリストが追加されるので，`名前`に`PWR`と入力し，`クリアランス`と`配線幅`を`0.6mm`に変更します．<br>

![fig.030_1](/pictures/030_1.png)

> 削除する場合は`ゴミ箱`アイコンを選択してください．<br>

このままでは反映されないので，`ネットクラス割り当て`下部の`+`アイコンを選択し，`パターン`に`VCC`，`ネットクラス`に`PWR`を割り当ててください．<br>
問題がなければ OK を選択し，ボードのセットアップとスタックアップ(デザインルール)は完了です．<br>

## 回路図からの変更のインポート

初期設定が終わりました．<br>早速，PCB 基板上に部品を乗せていきましょう．<br>

上部ツールバーから`回路図で行われた変更で基板(PCB)を更新`を選択します．<br>

![fig.031](/pictures/031.png)

> ショートカットキーは`F8`

`基板を更新`を選択してエラーが出ないことを確認してください．<br>

> エラーが出た場合は，まずはエラーメッセージをしっかり読んでください．<br>

`閉じる`を選択すると，マウスに追従して私達が先ほど選択したフットプリントが表示されます．<br>
左クリックでフットプリントを配置することができます．<br>

注意する点は，回路図エディターで行われた変更は PCB エディター側に自動で変更されません．<br>
必ず，`回路図で行われた変更で基板(PCB)を更新`を選択しましょう．<br>

## PCB 基板の 3D 表示

部品を配置できたので，試しに 3D モデルを見てみましょう．<br>
上部ツールバーから`3Dビューアーウィンドウを表示`を選択しましょう．<br>

![fig.032](/pictures/032.png)

> ショートカットキーは`Alt`+`3`<br> > <font color="red">※結構フリーズする</font><br>

どうでしょうか？ 理想通りの配置になっていますでしょうか．<br>
マウスの中ボタンでドラッグしてパンし，マウスの左ボタンでドラッグして周回します．<br>
もし，3D モデルが重なり合っている場合は，`干渉`を起こしていることがはっきりと分かると思います．<br>
この機能は非常によく使用し，設計ミスを事前に防ぐことができます．<br>

上部ツールバーから`レイトレーシングを使って現在のビューをレンダリング`を選択すると，より正確な描画をすることができます．<br>

![fig.033](/pictures/033.png)

> **注意！**<br>
> この機能は CPU に加わる負荷が<font color="red">非常に大きい</font>ものです！<br>
> 部品数の多い複雑な回路にレイトレーシングを適用してカメラ操作を行うと，ソフトウェアが<font color="red">フリーズ</font>することがあります！<br>

3D ビューアーウィンドウを閉じて終了しましょう．<br>

## フットプリントの配置修正

PCB エディターに配置したフットプリントをよく見ると，細い線で部品同士がつながっていると思います．<br>
実は先程，回路図エディターで配線した端子同士をソフトウェアが表示してくれているのです．<br>
設計者はこの細線を頼りに，自由に配線をすることができますが，今のままでは交差場所が多く，上手に配線できないことが予想されます．<br>
絡まった紐を解くように，フットプリント配置を修正しましょう．<br>

移動したいフットプリントを左クリックすることで移動できます．<br>

> うまく選択できない場合は，右下の`フィルター選択`から`フットプリント`のみにチェックを入れてみましょう．<br>
> 移動後は`すべてのアイテム`に戻すのを忘れずに！<br>
> フットプリントを選択した状態で右クリックを選択して，`右回転`，`左回転`を選択することでフットプリントを 90 度ごとに回転させることができます．<br>
> ショートカットキーは`R`，`Shift`+`R`<br>

また，部品配置を反対面に移動させたい場合は，フットプリントを選択した状態で右クリックを選択して，`配置面を変更/修正`を選択しましょう．<br>

> ショートカットキーは`F`<br>

フットプリントの外枠が青色になれば OK です．<br>

![fig.034](/pictures/034.png)

絡まった紐は，解けましたか？<br>

## 配線

細い線の根本は`パッド`です．<br>
これらパッド間を配線していきます．<br>

右側ツールバーから`配線`を選択します．<br>

![fig.035](/pictures/035.png)

> ショートカットキーは`X`<br>

細い線を参考に，パッド間を配線してください．<br>
配線作業中に右クリックして，`貫通ビアを配置`を選択して左クリックすると，`ビア`がその場に配置されます．<br>

> ショートカットキーは`V`<br>

`ビア`は基板の表と裏を行き来するための穴です．<br>
ビアを設置したあとに配線を伸ばすと，配線の色が赤から青に変化しています．<br>
赤い配線は基板の表側を意味し，青い配線は基板の裏側を意味します．<br>
必要に応じて使い分けてください

> 表面実装用(SMD)の抵抗と LED を使用している場合は，その部品が配置されている面でないとパッドが繋がりません！<br>

一部だけ，配線の太さが太くなっている箇所があります．<br>
これは先程設定した，デザインルールのネットクラスが関係しています．<br>
配線を拡大すると，`VCC`と記載されていることがわかります．<br>

![fig.036](/pictures/036.png)

必要に応じて，ネットクラスを調整しましょう．<br>

この状態で PCB 基板の 3D 表示を行うと，配線が追加されているのがわかります．<br>

## 基板のアウトライン(外形線)，レイヤーの選択

先程から PCB 基板の 3D 表示を行うと，`基板のアウトラインが欠如している`とのエラーが表示されています．<br>
これは基板のアウトラインを定めていなことによるエラーです．<br>

PCB エディターに戻り，右側ツールバーから，`矩形を描画`を選択します．<br>

![fig.037](/pictures/037.png)

この状態で回路を囲むように 2 点を選択すると矩形が描画されますが，これでは基板のアウトラインを描画できていません．<br>
実際，PCB 基板の 3D 表示を行うと，`基板のアウトラインが欠如している`とのエラーが引き続き表示されています．<br>

これは`レイヤー`が間違っているからです．<br>

右側の`外観`にはレイヤーの一覧が並んでいます．<br>
一番上には`F.Cu`，その下には`B.Cu`があり，そのどちらかの左に三角印があります．<br>
この`F.Cu`は`基盤表面の導体層`のレイヤーを表し，先程まで赤い配線を描いていたレイヤーを示しています．<br>
同様に，`B.Cu`は`基盤裏面の導体層`のレイヤーを表し，先程まで青い配線を描いていたレイヤーを示しています．<br>

このレイヤー指定が間違っていたため，矩形を描画しても`配線`と認識されて描画されてしまったのが原因です．<br>
では，基板のアウトラインに対応するレイヤーはどれでしょう．<br>
`Edge.Cuts`を選択してください．<br>

![fig.038](/pictures/038.png)

左側に三角印が表示され，レイヤーが指定されていれば OK です．<br>
この状態で先のように，回路を囲むように 2 点を選択すると，無事に基板のアウトラインが描画され，PCB 基板の 3D 表示を行うと，エラーが表示されなくなっていると思います．<br>

`矩形を描画`以外にも，`線を描画`，`円弧を描画`，`塩を描画`，`ポリゴンを描く`などがあります．<br>
各自，好きなように描画して，3D 表示に反映されているか確認してみましょう．<br>

![fig.039](/pictures/039.png)

これで PCB 基板は完成です．<br>

## 基板の塗りつぶし

技術的なテクニックのお話です．<br>
おまけ程度に聞いて下さい．<br>
F.Cu レイヤーを選択した状態で，右側ツールバーから`塗りつぶしゾーン`を追加を選択すると，`導体ゾーンのプロパティ`ウィンドウが開きます．<br>

![fig.040](/pictures/040.png)

> ショートカットキーは`Ctrl`+`Shift`+`Z`

`レイヤー`の`F.Cu`にチェックが入ってることを確認し，`ネット`から`GND`を選択し，`OK`を選択．<br>
基板のアウトラインを囲むように描画してみましょう．<br>
赤い斜線で囲まれたと思います．<br>
この状態で，`右クリック` -> `ゾーン` -> `すべてのゾーンを塗りつぶし`を選択すると，基板のアウトラインから内側が塗りつぶされたことがわかります．<br>

![fig.041](/pictures/041.png)

この塗りつぶされた部分は，すべて`GND`となりました．<br>
先ほど配線した GND 線を削除しても，問題ないことがわかります．<br>

![fig.042](/pictures/042.png)

PCB 基板の 3D 表示を行なって，確認してみましょう．<br>

> なぜ塗りつぶすの？<br>
> この作業は`ベタ塗り`と呼ばれ，主にノイズ対策のために使われるテクニックです．<br>
> 本当は両面をベタ塗りし，両面を導通させるためのビアを等間隔で大量に配置しなければノイズ対策にならないのですが，ここでは詳しく説明しません．<br>

## デザインルールチェック(DRC)

完成した基板の最終確認です．<br>
ボードのセットアップとスタックアップ(デザインルール)で設定した項目によって，基板が問題なく製造できるかのチェックを行います．<br>

> 何度も言いますが，ボードのセットアップとスタックアップ(デザインルール)が間違っていると，外注した際に，お金を払って`産業廃棄物`を作ることになります．<br>

上部ツールバーから`デザインルールチェッカーのウインドウを表示`を選択すると`デザインルールチェッカー`ウィンドウが開きます．<br>

![fig.043](/pictures/043.png)

あらゆるチェックマークにチェックを入れて，`DRCを実行`を選択しましょう．<br>
大量にエラーが出るかもしれませんが，一つ一つ修正しましょう．<br>
お金を払って産業廃棄物を生産するよりマシです．<br>

エラーが全て消えたら PCB 基板は完成です．<br>
お疲れ様でした！<br>

# Part4:外注

製作した基板を基板製作会社に外注するにはどうすればいいのでしょうか．<br>
ここでは`PCBWay`という，中国の基板製作会社に基板を外注することを想定してお話します．<br>
なお，[PCBWay 公式 HP](https://www.pcbway.jp/helpcenter/generate_gerber/Generate_Gerber_file_from_KiCAD.html)には詳細な情報がありますので，そちらも御覧ください．<br>

プロジェクトマネージャーから，`プラグイン&コンテンツマネージャー`を選択しましょう．<br>

![fig.044](/pictures/044.png)

ウィンドウが開きますので，フィルターに`PCBWay`と入力し，`PCBWay Plug-in for KiCAD`をインストールしましょう．<br>
このままでは`インストールを保留中`となり，まだインストールがされていない状態なので，`保留中の変更を適用`を選択すると，インストールが実行されます．<br>

インストールが完了したら，PCB エディターに戻ると，上部ツールバーに`PCBWay Plug-in for KiCAD`が追加されています．<br>

![fig.045](/pictures/045.png)

これを選択すると，なんと自動的にブラウザが立ち上がり，製造・購入画面の手前まで完了しています．<br>
後は，必要な枚数とメタルマスクや部品実装サービスのオプションを設定し，配送サービスを選び，支払いを済ませると数日後には基板が手元に届きます！

> 配送サービスは`DHL`を選ぶことを強く推奨します．<br>
> DHL はドイツの国際輸送物流会社です．<br>
> 日本にも DHL JAPAN という支部があり，安心・安全・高速配達のサービスを提供してくれます．<br>
> 他の配送サービスは DHL と比べて格安ですが，配達まで時間がかかり，荷物をよく紛失します(!?)

# まとめ

これにて KiCAD のチュートリアルは終了です．<br>
覚えることは多いでしょうが，数回ほど繰り返してみると，一連の作業が 20 分ほどで終わってしまいます．<br>
ソフトウェア上ではどれだけ作っても制作費用は発生しません！<br>
慣れるまで繰り返し練習しましょう！<br>

2 日目はいよいよ，乾電池モバイルバッテリーの回路を設計していただきます．<br>

自作シンボルやフットプリントの製作・追加方法<br>
工房に設置されている PCB 基板加工機用の加工データの製作方法<br>

これらをメインとして回路を作っていただきます．<br>
お疲れ様でした．<br>

# おまけ(フリーズ対策)

KiCAD はフリーソフトとはいえ，フリーズすることが多いソフトウェアです，<br>

特に，`ショートカットキー`を使用した際や`ウィンドウを変更`した際にフリーズし，右上のバツマークから終了しようとしても反応しないことが多々あります．<br>
この現象は過去 Ver から続く不具合で，根本的な解決には至っていません．<br>

主な原因は，Microsoft が提供する`Microsoft IME`との相性が悪いために起こります．<br>
解決方法としては`旧IMEに変更する`，または`Google 日本語入力を導入`するなど方法があります．<br>

Windows10 と Windows11 で設定方法が微妙に異なるので，[この URL](https://www.fmworld.net/cs/azbyclub/qanavi/jsp/qacontents.jsp?PID=8111-2706)を参考にしてください．<br>
~~なんで OS ごとに設定方法を変えるんだよ~~<br>
`旧IME`を選択すると，フリーズの頻度が大きく下がります．<br>

未完成状態<br>
2024/04/01
[fig]には画像が入る予定<br>
画像入れなきゃ<br>
